<column-mc:>
  <%= javascript_include_tag :ckeditor %>
  <%= javascript_include_tag "popup_email_template_editor" %>
  <header back="true" backurl="#{callers_campaigns_path}">
    <param:content>
      <%= t("agent_work_screen.index.title") %> - <%= @campaign.name %>
    </param:content>
    <param:actions>
      <div id="switch_campaign_form">
        <%= render :partial => "callers/agent_work_screen/switch_campaign_form", :locals => @locals %>
      </div>
    </param:actions>
  </header>

  <div id="flashes">
    <div class="flash flash_notice" style="display:none">
    </div>

    <div class="flash flash_alert" style="display:none">
    </div>
  </div>

  <%= t("agent_work_screen.index.contact_search_label") %> <%= text_field_tag "autocompleter", nil %>

  <a data-remote="true" data-method="get" id="autocomplter_result_form" href="" class="display:none"></a>

  <script language="javascript">
      $(document).ready(function() {
          jQuery.ajaxSetup({
              'beforeSend': function(xhr) {
                  xhr.setRequestHeader("Accept", "text/javascript")
              }
          });
          $("#autocompleter").autocomplete({
              url : 'callers/campaigns/<%= @campaign.id %>/contacts_for_search.js',
              mustMatch : false
          }
                  ).result(function(event, item) {
              $("#autocomplter_result_form").attr("href", "/callers/campaigns/<%= @campaign.id %>/agent_work_screen/contacts/" + item[1]).click();
          });

          $("#autocompleter").autocomplete('contacts_for_search', function(event, data, formatted) {
          });
      });

  </script>

  <div id="agent_work_screen_dashboard">
    <div id="contact_info">
      <%= render :partial => "callers/agent_work_screen/contact_form", :locals => @locals if @contact %>
    </div>

    <div id="call_info">
      <%= render :partial => "callers/agent_work_screen/call_interface", :locals => @locals if @contact %>
    </div>

    <br/>

    <div id="results_sheet">
      <%= render :partial => "callers/agent_work_screen/results_sheet", :locals => @locals %>
    </div>

    <div id="call_sheet" style="display:none">
      <%= render :partial => "callers/agent_work_screen/call_sheet", :locals => @locals %>
    </div>

    <div id="pending_calls" style="display:none">
      <%= render :partial => "callers/agent_work_screen/pending_calls", :locals => @locals %>
    </div>

    <div id="completed_contacts" style="display:none">
      <%= render :partial => "callers/agent_work_screen/completed_contacts", :locals => @locals %>
    </div>
  </div>

  <div id="agent_work_screen_call_result" style="display:none">

  </div>

  <div id="call_result_form">
    <%= render :partial => "callers/agent_work_screen/call_result_form", :locals => @locals %>
  </div>

  <div id="modal_for_email_template_edit" style="display:none;">
    <fieldset class="inputs labels_ta_r labels_70">
      <ol>
        <li id="template_editor_subject_input" class="string">
          <%= label_tag t("agent_work_screen.index.email_templates_editor.subject") %>
          <%= text_field_tag :subject %>
        </li>
        <li id="template_editor_bcc_input" class="string">
          <%= label_tag t("agent_work_screen.index.email_templates_editor.bcc") %>
          <%= text_field_tag :bcc %>
        </li>
        <li id="template_editor_cc_input" class="string">
          <%= label_tag t("agent_work_screen.index.email_templates_editor.cc") %>
          <%= text_field_tag :cc %>
        </li>
        <li id="template_editor_body_input" class="text">
          <%= text_area_tag :body, "<p></p>", {:class => "editor", :id => "body_editor"} %>
        </li>
      </ol>
    </fieldset>
  </div>

</column-mc:>

<js:>
  <script type="text/javascript">
      <% if !@contact and @pending_contacts.any? %>
      display_notice("<%= escape_javascript(t("contacts.show.flash.you_have_only_callback_contacts")) %>", false);
      <% elsif !@contact%>
      display_notice("<%= escape_javascript(t("contacts.show.flash.you_have_no_contacts_assigned")) %>", false);
      <% end %>

      $("#change_campaign_id").live("change", function() {
          $(this).parents("form").submit()
      });

      $('#modal_for_email_template_edit').dialog({
          autoOpen: false,
          width: 1120,

          title: 'Edit email template',
          open: function(event, ui) {
              init_ck_editor();
              setTimeout("init_email_template_editor_with_values();", 300);
          },
          beforeClose: function(event, ui) {
              if (validate_template_editor_fields() == 0) {
                  return true
              } else {
                  return false
              }
          },
          buttons: { "Save": function() {
              if (validate_template_editor_fields() == 0) {
                  $(this).dialog("close");
              }
          }}
      });
      $('#modal_for_email_template_edit').dialog("option", "email_template_editor_init_values_function", "");
  </script>
</js:>

