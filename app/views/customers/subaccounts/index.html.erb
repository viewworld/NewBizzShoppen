<column-mc:>
  <h1><%= t("customer.subaccounts.index.view.title") %></h1>
  <%= link_to t("customer.subaccounts.index.view.new_lead_buyer"), new_customers_subaccount_path(:role => "lead_buyer") %>
  <%= link_to t("customer.subaccounts.index.view.new_lead_user"), new_customers_subaccount_path(:role => "lead_user") %>

  <% [1, 10, 25, 50, 0].each do |per_page| %>
      <%= link_to per_page == 0 ? t("customer.subaccounts.index.view.none_per_page") : per_page.to_s, customers_subaccounts_path(:per_page => per_page) %>
  <% end %>

<%= bulk_form do %>
    <table id="subaccounts_table" class="generic">
        <thead>
            <tr>
              <th><%= check_box_tag "mark_all", 1, false, :onclick => "mark_all_cbs_with_selector(this.checked,'input:checkbox')" %></th>
              <th><%= link_to t("customer.subaccounts.index.view.first_name_column"), order_for_scoped_search(:first_name) %></th>
              <th><%= link_to t("customer.subaccounts.index.view.last_name_column"), order_for_scoped_search(:last_name) %></th>
              <th><%= link_to t("customer.subaccounts.index.view.department_column"), order_for_scoped_search(:department) %></th>
              <th><%= t("customer.subaccounts.index.view.actions_column") %></th>
            </tr>
        </thead>

        <tbody>
            <% @users.each do |user| %>
                <tr>
                  <td><%= check_box_tag "user_ids[]", user.id %></td>
                  <td><%= user.first_name %></td>
                  <td><%= user.last_name %></td>
                  <td><%= user.department %></td>
                  <td>
                    <%= link_to t("customer.subaccounts.index.view.assigned_leads"), buyers_lead_purchases_path(:search => { :with_assignee => user.id }) %>
                    <%= link_to user.locked_at.blank? ? t("customer.subaccounts.index.view.lock") : t("customer.subaccounts.index.view.unlock"), customers_subaccount_path(user, {"user_#{user.role.to_s}".to_sym  => {:locked =>  user.locked_at.blank? ? "lock" : "unlock"}}), {:method => :put} %>
                    <%= link_to t("customer.subaccounts.index.view.edit"), edit_customers_subaccount_path(user) %>
                    <%= link_to t("customer.subaccounts.index.view.delete"), customers_subaccount_path(user), {:method => :delete, :confirm => t("customer.subaccounts.index.view.delete_confirmation_message")} %>
                  </td>
                </tr>
            <% end %>
        </tbody>
    </table>
    <%= hidden_field_tag :route_to %>
    <%= select_tag :locked, options_for_select([[t("customer.subaccounts.index.view.lock"), "locked"], [t("customer.subaccounts.index.view.unlock"), "unlock"]]) %>
    <%= button_to_function t("customer.subaccounts.index.view.button_bulk_subbaccounts_update"), "submitBulkForm('#{customers_bulk_subaccounts_update_path}#PUT');" %>
<% end %>
  <%= will_paginate @users unless params[:per_page].to_i == 0 %>
</column-mc:>