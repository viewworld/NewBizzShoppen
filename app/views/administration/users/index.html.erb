<search-box:>
  <div class="search_box">
    <h2><%= t("common.search") %></h2>

    <div class="search_content">

      <%= form_for @search, :url => administration_users_path do |f| %>
          <%= f.hidden_field :with_subaccounts %>
          <fieldset class="inputs_vertical">
            <ol class="no_pdd">
              <li class="string">
                <%= f.label :with_keyword, t("administration.leads.index.search.keyword_label") %>
                <%= f.text_field :with_keyword %>
              </li>
              <li class="select">
                <%= f.label "User Role" %>
                <%= f.select :with_role, User::BASIC_USER_ROLES_WITH_LABELS, :include_blank => true %>
              </li>
              <li class="commit">
                <ibt c="bt_green" icon="magnify">
                  <%= submit_tag t("administration.users.index.view.search_button") %>
                </ibt>
                <ibt c="fltri bt_grey">
                  <%= bt_clear_filter %>
                </ibt>
              </li>
            </ol>
          </fieldset>
      <% end %>
    </div>
  </div>
</search-box:>

<column-mc:>

  <header>
    <param:content>
      <% if @search.with_subaccounts.blank? %>
          <%= t("administration.users.index.view.title") %>
      <% else %>
          <% user = User.find(@search.with_subaccounts) %>
          <%= t("administration.users.index.view.subaccounts_for_user", :user_name => user.full_name) %>
          <%= link_to t("administration.users.index.view.show_all_users"), administration_users_path %>
      <% end %>
    </param:content>

    <param:actions>
      <%= form_tag new_administration_user_path, :method => :get, :id => "form_new_user" do %>
          <span style="position:absolute;top: 5px; right: 110px;">
            <%= select_tag "role", options_for_select(User::BASIC_USER_ROLES_WITH_LABELS), {} %>
          </span>
          <ul class="header_actions">
            <li class="last">
              <div class="hidden">
                <%= submit_tag t("administration.users.index.view.new_user") %>
              </div>
              <%= bt_link_to :plus, t("administration.users.index.view.new_user"), "javascript:void", :onclick => "$('#form_new_user').submit()" %>
            </li>
          </ul>
      <% end %>
    </param:actions>
  </header>

  <% if @users.blank? %>
      <%= blank_state_message %>
  <% else %>
      <%= bulk_form do %>
          <table id="users_table" class="generic">
            <thead>
            <tr>
              <th class="hl"></th>
              <th class="no_pdd_lr"><%= check_box_tag "mark_all", 1, false, :onclick => "mark_all_cbs_with_selector(this)" %></th>
              <th><%= link_to t("administration.users.index.view.id"), order_for_scoped_search(:id) %></th>
              <th><%= link_to t("administration.users.index.view.roles"), order_for_scoped_search(:roles_mask) %></th>
              <th><%= link_to t("administration.users.index.view.first_name"), order_for_scoped_search(:first_name) %></th>
              <th><%= link_to t("administration.users.index.view.last_name"), order_for_scoped_search(:last_name) %></th>
              <th><%= link_to t("administration.users.index.view.email"), order_for_scoped_search(:email) %></th>
              <th><%= link_to t("administration.users.index.view.age"), order_for_scoped_search(:age) %></th>
              <th><%= link_to t("administration.users.index.view.leads_bought"), order_for_scoped_search(:leads_purchased_counter) %></th>
              <th><%= link_to t("administration.users.index.view.leads_created"), order_for_scoped_search(:leads_created_counter) %></th>
              <th><%= link_to t("administration.users.index.view.leads_sold"), order_for_scoped_search(:leads_volume_sold_counter) %></th>
              <th><%= link_to t("administration.users.index.view.revenue"), order_for_scoped_search(:leads_revenue_counter) %></th>
              <th><%= link_to t("administration.users.index.view.payout"),order_for_scoped_search(:payout) %></th>
              <th class="ta_c"><%= t("administration.users.index.view.locked") %></th>
              <th class="ta_r"><%= t("administration.users.index.view.actions") %></th>
              <th class="hr"></th>
            </tr>
            </thead>
            <tfoot>
            <tr>
              <td class="fl"></td>
              <td colspan="14"></td>
              <td class="fr"></td>
            </tr>
            </tfoot>
            <tbody>
            <% @users.each do |user| %>
                <tr class="<%= cycle("odd", "even") %>">
                  <td class="cl"></td>
                  <td class="no_pdd_lr"><%= check_box_tag("user_ids[]", user.id) unless user.id == current_user.id %></td>
                  <td><%= user.id %></td>
                  <td><%= user.roles_as_text %></td>
                  <td><%= user.first_name %></td>
                  <td><%= user.last_name %></td>
                  <td><%= user.email %></td>
                  <td><%= user.age %></td>
                  <td><%= user.leads_purchased_counter %></td>
                  <td><%= user.leads_created_counter %></td>
                  <td><%= user.leads_volume_sold_counter %></td>
                  <td><%= user.leads_revenue_counter %></td>
                  <td><%= user.payout %></td>
                  <td class="ta_c">
                    <% unless user.id == current_user.id %>
                        <%= link_to user.locked_at.blank? ? t("administration.users.index.view.lock") : t("administration.users.index.view.unlock"), administration_user_path(user, {"user_#{user.role.to_s}".to_sym  => {:locked =>  user.locked_at.blank? ? "lock" : "unlock"}}), {:method => :put} %>
                    <% end %>
                  </td>
                  <td class="tda ta_r">
                    <ul-actions>
                      <li>
                        <%= link_to t("administration.users.index.view.edit"), edit_administration_user_path(user), :class => "default_action" %>
                      </li>
                      <li>
                        <%= link_to t("administration.users.index.view.delete"), administration_user_path(user), {:method => :delete, :confirm => t("administration.users.index.view.delete_confirmation_message")} %>
                      </li>
                      <% unless user.subaccounts.empty? %>
                          <li>
                            <%= link_to t("administration.users.index.view.subaccounts"), administration_users_path({:search => {:with_subaccounts => user.id}}) %>
                          </li>
                      <% end %>
                      <% if user.has_role?(:customer) %>
                          <li><%= link_to t("administration.users.index.view.create_invoice"), new_administration_invoicing_invoice_path(:invoice => {:user_id => user.id}) %></li>
                      <% end %>
                    </ul-actions>
                  </td>
                  <td class="cr"></td>
                </tr>
            <% end %>
            <tr class="pagination">
              <td colspan="16" class="ta_c">
                <div class="td_select_all">
                  <%= check_box_tag "mark_all", 1, false, :onclick => "mark_all_cbs_with_selector(this)" %>
                  <%= label_tag "mark_all", "select all" %>
                </div>
                <%= will_paginate @users %>
              </td>
            </tr>
            <tr class="main_actions">
              <td class="cl"></td>
              <td colspan="14" class="no_pdd_lr ta_l">
                <%= hidden_field_tag :route_to %>
                <%= hidden_field_tag :bulk_action_type %>
                <%= bt_link_to :invoice, t("administration.users.index.view.create_invoice"), "javascript:void(0)", :onclick => "$('#bulk_action_type').val('create_invoice'); submitBulkForm('#{administration_bulk_users_update_path}#PUT');", :id => "invoice_selected" %>
                <%= bt_link_to :padlock, t("administration.users.index.view.lock_selected"), "javascript:void(0)", :onclick => "$('#bulk_action_type').val('lock'); submitBulkForm('#{administration_bulk_users_update_path}#PUT');", :id => "lock_selected" %>
                <%= bt_link_to :unlock, t("administration.users.index.view.unlock_selected"), "javascript:void(0)", :onclick => "$('#bulk_action_type').val('unlock'); submitBulkForm('#{administration_bulk_users_update_path}#PUT');", :id => "unlock_selected" %>
              </td>
              <td class="cr"></td>
            </tr>
            </tbody>
          </table>
      <% end %>
  <% end %>
</column-mc:>