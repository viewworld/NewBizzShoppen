<search-box:>
  <div class="search_box">
    <h2>Search</h2>

    <div class="search_content">

      <%= form_for @search, :url => administration_users_path do |f| %>
          <%= f.hidden_field :with_subaccounts %>
          <fieldset class="inputs_vertical">
            <ol class="no_pdd">
              <li class="string">
                <%= f.label :with_keyword, t("administration.leads.index.search.keyword_label") %>
                <%= f.text_field :with_keyword %>
              </li>
              <li class="select">
                <%= f.label "User Role" %>
                <%= f.select :with_role, User::BASIC_USER_ROLES_WITH_LABELS, :include_blank => true %>
              </li>
              <li class="commit">
                <ibt c="bt_green" icon="magnify">
                  <%= submit_tag t("administration.users.index.view.search_button") %>
                </ibt>
              </li>
            </ol>
          </fieldset>
      <% end %>
    </div>
  </div>
</search-box:>

<column-mc:>

  <header>
    <param:content>
      <% if @search.with_subaccounts.blank? %>
          <%= t("administration.users.index.view.title") %>
      <% else %>
          <% user = User.find(@search.with_subaccounts) %>
          <%= t("administration.users.index.view.subaccounts_for_user", :user_name => user.full_name) %>
          <%= link_to t("administration.users.index.view.show_all_users"), administration_users_path %>
      <% end %>
    </param:content>

    <param:actions>
      <%= form_tag new_administration_user_path, :method => :get, :id => "form_new_user" do %>
          <span style="position:absolute;top: 5px; right: 110px;">
            <%= select_tag "role", options_for_select(User::BASIC_USER_ROLES_WITH_LABELS), {} %>
          </span>
          <ul class="header_actions">
            <li class="last">
              <div class="hidden">
                <%= submit_tag t("administration.users.index.view.new_user") %>
              </div>
              <%= bt_link_to :plus, t("administration.users.index.view.new_user"), "javascript:void", :onclick => "$('#form_new_user').submit()" %>
            </li>
          </ul>
      <% end %>
    </param:actions>
  </header>


  <table id="users_table" class="generic">
    <thead>
    <tr>
      <th class="hl"></th>
      <th><%= link_to t("administration.users.index.view.id"), order_for_scoped_search(:id) %></th>
      <th><%= link_to t("administration.users.index.view.roles"), order_for_scoped_search(:roles_mask) %></th>
      <th><%= link_to t("administration.users.index.view.first_name"), order_for_scoped_search(:first_name) %></th>
      <th><%= link_to t("administration.users.index.view.last_name"), order_for_scoped_search(:last_name) %></th>
      <th><%= link_to t("administration.users.index.view.email"), order_for_scoped_search(:email) %></th>
      <th><%= link_to t("administration.users.index.view.age"), order_for_scoped_search(:age) %></th>
      <th><%= t("administration.users.index.view.leads_bought") %></th>
      <th><%= t("administration.users.index.view.leads_sold") %></th>
      <th><%= t("administration.users.index.view.revenue") %></th>
      <th><%= t("administration.users.index.view.payout") %></th>
      <th class="ta_c"><%= t("administration.users.index.view.locked") %></th>
      <th class="ta_r"><%= t("administration.users.index.view.actions") %></th>
      <th class="hr"></th>
    </tr>
    </thead>
    <tfoot>
    <tr>
      <td class="fl"></td>
      <td colspan="12"></td>
      <td class="fr"></td>
    </tr>
    </tfoot>
    <tbody>
    <% @users.each do |user| %>
        <tr>
          <td class="cl"></td>
          <td><%= user.id %></td>
          <td><%= user.roles_as_text %></td>
          <td><%= user.first_name %></td>
          <td><%= user.last_name %></td>
          <td><%= user.email %></td>
          <td><%= user.age %></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td class="ta_c">
            <% unless user.id == current_user.id %>
                <%= link_to user.locked_at.blank? ? t("administration.users.index.view.lock") : t("administration.users.index.view.unlock"), administration_user_path(user, {"user_#{user.role.to_s}".to_sym  => {:locked =>  user.locked_at.blank? ? "lock" : "unlock"}}), {:method => :put} %>
            <% end %>
          </td>
          <td class="tda ta_r">
            <ul-actions>
              <li>
                <%= link_to t("administration.users.index.view.edit"), edit_administration_user_path(user) %>
              </li>
              <li>
                <%= link_to t("administration.users.index.view.delete"), administration_user_path(user), {:method => :delete, :confirm => t("administration.users.index.view.delete_confirmation_message")} %>
              </li>
              <% unless user.subaccounts.empty? %>
                  <li>
                    <%= link_to t("administration.users.index.view.subaccounts"), administration_users_path({:search => {:with_subaccounts => user.id}}) %>
                  </li>
              <% end %>
            </ul-actions>
          </td>
          <td class="cr"></td>
        </tr>
    <% end %>
    </tbody>
  </table>

  <%= will_paginate @users %>

</column-mc:>