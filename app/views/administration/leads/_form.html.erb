<div class="pdd_10 no_pdd_t">
  <fieldset class="inputs labels_ta_r labels_240">
    <ol>
      <%= form.input :category_id, :as => :select, :collection => Category.without_locked, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :country_id, :as => :select, :collection => Country.all, :input_html => { :disabled => form.object.sold? } %>
    </ol>
  </fieldset>
</div>
<hl/>

<div class="pdd_10 no_pdd_t">
  <fieldset class="inputs labels_ta_r labels_240">
    <ol class="align_inputs">
      <%= form.input :purchase_value, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :price, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :currency, :collection => currencies_for_select, :include_blank => false, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :company_name, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :contact_name, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :phone_number, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :email_address, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :linkedin_url, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :facebook_url, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :address_line_1, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :address_line_2, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :address_line_3, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :city, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :county, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :zip_code, :input_html => { :disabled => form.object.sold? } %>
      <% if current_user.can_publish_leads? %>
        <%= form.input :published, :input_html => { :disabled => form.object.sold? } %>
      <% else %>
        <%= form.input :published, :as => :hidden, :input_html => { :disabled => form.object.sold? } %>
      <% end %>
    </ol>
  </fieldset>
</div>
<hl/>

<div class="pdd_10 no_pdd_t">
  <fieldset class="inputs labels_ta_r labels_240">
    <ol class="align_inputs">
      <%= form.input :header, :input_html => { :disabled => form.object.sold? } %>
      <%= form.input :description, :input_html => {:style => "height: 140px; width: 600px", :disabled => form.object.sold? } %>
      <%= form.input :hidden_description, :input_html => {:style => "height: 140px; width: 600px", :disabled => form.object.sold? } %>
    </ol>
  </fieldset>
</div>
<hl/>

<div class="nested_locale_container"></div>

<%= form.fields_for :lead_translations, @lead.lead_translations.select { |lt| lt.locale != I18n.locale.to_s } do |builder| %>
    <%= render :partial => "lead_fields", :locals => {:f => builder} %>
<% end %>

<div class="pdd_10 no_pdd_t">
  <fieldset class="inputs labels_ta_r labels_240">
    <ol class="align_inputs">
      <li class="select">
      <%= form.label :locale, "New translation" %>
      <%= select_tag :locale, options_for_select(available_locales_list(@lead.lead_translations)),
               {:id => "locale_picker", :include_blank => true, :onchange => fields_for_leads_translations(form)} %>
      </li>
    </ol>
  </fieldset>
</div>
<hl/>

<div class="pdd_10 no_pdd_t">
  <fieldset class="inputs labels_ta_r labels_240">
    <ol class="align_inputs">
      <%= form.input :notify_buyers_after_update, :as => :boolean unless @lead.lead_purchases.empty? %>
      <%= form.input :sale_limit, :as => :select, :collection => (0..10) %>
      <%= form.input :purchase_decision_date, :as => :string, :input_html => {:id => "datepicker"} %>
    </ol>
  </fieldset>
</div>



<script>
    var nestedFormsCount = <%= @lead.lead_translations.reject{ |lt| lt.locale == I18n.locale.to_s }.size %>;
    $(function() {
        $("#datepicker").datepicker({ dateFormat: 'yy-mm-dd' });
    });
    function add_fields(link, content) {
        if ($('#locale_picker').text() != null)
        {
            var new_id = new Date().getTime();
            var regexp = new RegExp("");
            content = content.replace(/lead_lead_translations_attributes_0/g, "lead_lead_translations_attributes_" + nestedFormsCount.toString());
            content = content.replace(/lead\[lead_translations_attributes\]\[0\]/g, "lead[lead_translations_attributes][" + new_id.toString() + "]");
            content = content.replace(/LOCALE_LANG/, $('#locale_picker').val());
            $('.nested_locale_container:last').append(content);
            $('.locale_hidden_field:last').val($('#locale_picker').val());
            $('.locale_title:last').html($('#locale_picker').val());
            $("option[value=" + $('#locale_picker').val() + "]").remove();
            nestedFormsCount = nestedFormsCount + 1;
        }
    }

    function remove_language(id, locale, record_id) {
        nestedFormsCount = nestedFormsCount - 1;
        $('#locale_picker').append($("<option></option>").attr("value", locale).text(locale));
        if (record_id == null)
        {
            $('#lead_translation_form_' + id).remove();
        }
        else
        {
            $('#lead_translation_form_' + id).hide();
            $('#destroy_hidden_field_' + record_id.toString()).val('true')
        }

    }
</script>