<% SurveyQuestion::QUESTION_TYPES.each do |qtype| %>
    <div class="draggable_question_type survey_question" data-qtype="<%= qtype %>" style="border: 2px green solid;" data-id="null"><%= t("surveys_management.shared.question_types.type#{qtype}") %></div>
<% end %>

  <div class="pdd_10 no_pdd_t">
    <fieldset class="inputs labels_ta_r">
      <ol class="align_inputs">
        <%= form.input :title %>

      </ol>
    </fieldset>
  </div>

<div style="border: 2px green dashed" id="survey_questions_container">
  <%= render :partial => "survey_questions", :locals => { :survey => @survey } %>
</div>


<script>
    function removeQuestion(id){
        if(confirm("<%= t("common.confirmation") %>")){
            $.ajax({url: "/surveys_management/surveys/<%= @survey.id %>/survey_questions/" + id, type: "DELETE"});
        }
    }

    function editQuestion(id){
        $.colorbox({href: "/surveys_management/surveys/<%= @survey.id %>/survey_questions/" + id + "/edit",
            width: 600, height: 500
        });
    }
    $(function() {
        $("#survey_questions_container").sortable({
            update: function( event, ui ) {
                if(ui.item.hasClass("draggable_question")){
                    $.post("/surveys_management/surveys/<%= @survey.id %>/survey_questions/sort", { ids: $.map($('.draggable_question'), function(el) { return $(el).attr("data-id") } ) })
                }

            }
        });

        $("#survey_questions_container").disableSelection();

        $(".draggable_question_type").draggable({
            revert: "invalid",
            connectToSortable:"#survey_questions_container",
            helper:"clone"
        });


        $("#survey_questions_container").droppable({
            accept: ".draggable_question_type",
            drop: function(event, ui) {
                setTimeout(function(){
                    orderArray = $.map($('div#survey_questions_container .survey_question'), function(el) { return $(el).attr("data-id") });
                    position = orderArray.indexOf("null") + 1;
                    $.colorbox({href: "/surveys_management/surveys/<%= @survey.id %>/survey_questions/new?position=" + position + "&question_type=" + $(ui.helper).attr("data-qtype"),
                        width: 600, height: 500,
                        onClosed: function(){
                            $('#survey_questions_container').find("div[data-id=null]").remove();
                        }});

                }, 100);
            }
        });
    });
</script>