@m17 @global_deal_changes @is
Feature: Deals global changes

  Background:
    Given I am on the homepage
    And I sign in as admin@nbs.com with password secret
    Then a deal is created by "admin@nbs.com" for user "buyer@nbs.com" and category "Business deals" with attributes "header:awesome|description:awesome|hidden_description:awesome|start_date:2011-01-01|end_date:2011-01-01|company_name:starks"

  Scenario: As PM I should be able to share the short deal info on the social networks (facebook, twitter, linkedin)

  @_done @_tested @selenium
  Scenario: I should be able to set normal price and discounted
    Then I follow translated "layout.main_menu.admin.deals"
    Then I click hidden link by url regex "/administration\/deals\/\d+\/edit/"
    Then I fill group deal edit form and submit with translated button "administration.deals.edit.view.update_button"
    Then I click hidden link by url regex "/administration\/deals\/\d+\/edit/"

  @_done @_tested_elsewhere
  Scenario: I should be able to set social media short deal info

  Scenario: I should see the saving % (calculated) in browse deals for deals with discounted price

  Scenario: I should be able to see the slug for the view deal's details url

  Scenario: I should be able to see the total leads generated by deal

  @_done @_tested
  Scenario: As admin I can change the number of generated leads from a deal
    Then I follow translated "layout.main_menu.admin.deals"
    Then I follow translated "administration.deals.index.view.edit"
    Then I fill in "deal_created_leads" with "-1"
    Then I press translated "administration.deals.edit.view.update_button"
    Then I fill in "deal_created_leads" with "12.3"
    Then I press translated "administration.deals.edit.view.update_button"
    Then I fill in "deal_created_leads" with "error"
    Then I press translated "administration.deals.edit.view.update_button"
    Then I fill in "deal_created_leads" with "0"
    Then I press translated "administration.deals.edit.view.update_button"
    Then I should see translated "flash.deals.update.notice"
    Then I follow translated "administration.deals.index.view.edit"
